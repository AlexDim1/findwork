<!DOCTYPE html>
<html lang="en" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" th:href="@{/css/offerDecor.css}">
	<title>Offer</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
	      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
	        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
	        crossorigin="anonymous"></script>
	<title th:text="${offer.title}"></title>
	<link rel="stylesheet" th:href="@{/css/offerDecor.css}">
</head>
<body>
<p>OFFER</p>
<p th:text="${error}"></p>
<p th:text="${success}"></p>
<!--<th:block th:each="offerField : ${offer}">-->
<!--	<li th:text="${offer.title}">-->
<!--	<li th:text="${offer.requirements}"></li>-->
<!--	<li th:text="${offer.location}"></li>-->
<!--	<li th:text="${offer.salary}"></li>-->
<!--	<li th:text="${offer.jobLevel}"></li>-->
<!--	<li th:text="${offer.jobCategory}"></li>-->
<!--	<li th:text="${offer.company.name}"></li>-->
<!--</th:block>-->
<header id="nav">
	<nav>
		<section class="logo">
			<a>FindWork</a>
		</section>
		<ul>
			<li><a href="/">Home</a></li>
			<li><a href="/offer/">Offers</a></li>
			<li><a href="/user/{id}">Profile</a></li>
			<li><a href="/logout">Logout</a></li>
		</ul>
	</nav>
</header>

<section id="detailsPage">
	<div class="details">
		<div class="offerPic">
			<img src=${pet.image}>
		</div>
		<div>
			<div class="offerInfo">
				<th:block th:each="offer : ${offers}">
					<h2 th:text= "${offer.company.name}"></h2>
					<p th:text = "${offer.title}" ></p>
					<p th:text= "${offer.jobCategory}" ></p>
					<p th:text = "${offer.jobLevel}" ></p>
					<p th:text= "${offer.location}" ></p>
					<p th:text = "${offer.salary}" ></p>
					<p th:text= "${offer.requirements}" ></p>
				</th:block>
			</div>

			<div class="actionBtn">
				<a href="/offer/{id}" class="apply">Apply</a>
			</div>
		</div>
	</div>
</section>
<footer>FindWork 2022©</footer>
<th:block th:insert="fragments/navbar :: navbar"></th:block>
<p th:if="${error != null}" th:text="${error}"></p>
<p th:if="${success != null}" th:text="${success}"></p>
<h1 th:text="${offer.title}"></h1>
<a th:href="@{/company/{id}(id=${offer.company.id})}" th:text="${offer.company.name}"></a>
<p th:text="${offer.location}"></p>
<p th:text="${offer.salary}"></p>
<p th:text="${offer.jobLevel}"></p>
<p th:text="${offer.description}"></p>
<p th:text="${offer.requirements}"></p>
<p th:text="${offer.niceToHave}"></p>
<p th:text="${offer.benefits}"></p>
<p th:text="${offer.jobCategory}"></p>
<!--Само една от долните 2 форми може да съществува в даден момент в зависимост дали обявата е сейвната, и то само ако сме логнати като user -->
<form sec:authorize="hasAuthority('User')" th:if="${saved != null && saved == false}"
      th:action="@{/offers/{id}/save(id=${offer.id})}" method="post">
	<button type="submit">Save Offer</button>
</form>
<form sec:authorize="hasAuthority('User')" th:if="${saved != null && saved == true}"
      th:action="@{/offers/{id}/unsave(id=${offer.id})}" method="post">
	<button type="submit">Unsave Offer</button>
</form>
<form sec:authorize="hasAuthority('Company')" th:if="${#authentication.principal.username == offer.company.username}"
      th:action="@{/offers/{id}/edit(id=${offer.id})}" method="get">
	<button type="submit">Edit</button>
</form>
<form sec:authorize="hasAuthority('User')" th:if="${applied != null && applied == false}"
      th:action="@{/offers/{id}/apply(id=${offer.id})}" method="post">
	<button type="submit">Apply!</button>
</form>
<form sec:authorize="hasAuthority('User')" th:if="${applied != null && applied == true}"
      th:action="@{/offers/{id}/cancel(id=${offer.id})}" method="post">
	<button type="submit">Cancel application</button>
</form>
</body>
</html>